<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>upload podcast</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>
</head>
<body>
<div class="container text-center">
    <div class="mb-3">
        <label for="tenTruyen" class="form-label">Tên truyện</label>
        <input class="form-control" id="tenTruyen"/>
    </div>
    <div class="mb-3">
        <label for="tacGia" class="form-label">Tác giả</label>
        <input class="form-control" id="tacGia"/>
    </div>
    <div class="mb-3">
        <label for="loai" class="form-label">Loại</label>
        <input class="form-control" id="loai"/>
    </div>
    <div class="mb-3">
        <label for="anhbia" class="form-label">Chọn ảnh</label>
        <input class="form-control" type="file" id="anhbia" onchange="getImageData(event)"/>
    </div>
    <div class="mb-3">
        <label for="formFile" class="form-label">Chọn tệp</label>
        <input class="form-control" type="file" id="formFile" onchange="getFileData(event)">
    </div>
    <div class="progressBar">
        <div class="progress"></div>
    </div>
    <button class="upload" onclick="uploadAll()">Tải lên</button>
</div>
</body>
<script>
    // Import the functions you need from the SDKs you need
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyDDSE5F0jhmpvtX-z7o-1L9RpUc5u1bodM",
        authDomain: "mlis-18b55.firebaseapp.com",
        projectId: "mlis-18b55",
        storageBucket: "mlis-18b55.appspot.com",
        messagingSenderId: "1072635823588",
        appId: "1:1072635823588:web:02120dbc2809327ac0f3f1",
        measurementId: "G-ZMWW7ZNJCG"
    };

    const app = firebase.initializeApp(firebaseConfig);

    const storage = firebase.storage();

    const inp = document.querySelector(".inp");
    const progressbar = document.querySelector(".progress");
    const img = document.querySelector(".img");
    const fileData = document.querySelector(".filedata");
    const loading = document.querySelector(".loading");
    let file;
    let fileName;
    let fileImage;
    let fileImageName;
    let progress;
    let isLoading = false;
    let uploadedImageFileName;
    function getImageData(e) {
        fileImage = e.target.files[0];
        fileImageName = Math.round(Math.random() * 9999) + fileImage.name;
        console.log(fileImage, fileImageName);
    }
    function getFileData(e) {
        file = e.target.files[0];
        fileName = Math.round(Math.random() * 9999) + file.name;
        console.log(file, fileName);
    }

    function uploadImage () {
        const storageRef = storage.ref().child("myimages");
        const folderRef = storageRef.child(fileImageName);
        const uploadtask = folderRef.put(fileImage);
        uploadtask.on(
            "state_changed",
            (snapshot) => {
                console.log("Snapshot", snapshot.ref.name);
                progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progress = Math.round(progress);
                progressbar.style.width = progress + "%";
                progressbar.innerHTML = progress + "%";
                uploadedImageFileName = snapshot.ref.name;
            },
            (error) => {
                console.log(error);
            },
            () => {
                storage
                    .ref("myimages")
                    .child(uploadedImageFileName)
                    .getDownloadURL()
                    .then((url) => {
                        console.log("URL", url);
                    });
                console.log("File Uploaded Successfully");
            }
        );
    }
    function uploadFile () {
        let uploadedFileName;
        const storagefRef = storage.ref().child("myfiles");
        const folderRef = storagefRef.child(fileName);
        const uploadtask = folderRef.put(file);
        uploadtask.on(
            "state_changed",
            (snapshot) => {
                console.log("Snapshot", snapshot.ref.name);
                progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progress = Math.round(progress);
                progressbar.style.width = progress + "%";
                progressbar.innerHTML = progress + "%";
                uploadedFileName = snapshot.ref.name;
            },
            (error) => {
                console.log(error);
            },
            () => {
                storage
                    .ref("myfiles")
                    .child(uploadedFileName)
                    .getDownloadURL()
                    .then((url) => {
                        console.log("URL", url);
                    });
                console.log("File Uploaded Successfully");
            }
        );
    }
    function uploadAll (){
        uploadImage()
        uploadFile()
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</html>